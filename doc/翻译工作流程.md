# SSE Auto Translator - 翻译工作流程

## 概述

本文档描述了SSE Auto Translator (SSE-AT)中的翻译工作流程，解释了应用程序如何处理查找、创建和应用《上古卷轴5：特别版》模组翻译的过程。

## 翻译来源

SSE-AT可以从多个来源获取翻译：

1. **Nexus Mods**
   - 翻译的主要来源
   - 使用Nexus Mods API查找已安装模组的翻译
   - 直接从Nexus Mods下载翻译文件

2. **Confrerie des Traducteurs**
   - 翻译的替代来源
   - 专注于法语翻译
   - 作为附加翻译提供者集成

3. **本地文件**
   - 用户可以从本地文件导入翻译
   - 支持各种格式，包括归档（.zip、.7z、.rar）、插件（.esp、.esm、.esl）、DSD翻译（.json）和xTranslator导出（.xml）

4. **机器翻译**
   - 内置翻译API集成
   - 支持Google翻译和DeepL
   - 用于字符串的自动翻译

## 翻译数据库

应用程序维护一个翻译数据库：

1. **原版翻译**
   - 包含基础游戏字符串的翻译
   - 用作创建新翻译的参考

2. **用户翻译**
   - 用户安装的翻译
   - 存储在用户数据库目录中
   - 索引以便快速访问和管理

## 翻译工作流程

### 1. 扫描模组列表

当用户启动模组列表扫描时：

1. 应用程序从选定的模组管理器检索已安装模组的列表
2. 对于每个模组，它识别需要翻译的插件
3. 它检查翻译数据库，查看哪些插件已经有翻译
4. 它将插件标记为：
   - 已翻译：数据库中存在翻译
   - 未翻译：不存在翻译
   - 部分翻译：一些字符串已翻译，但不是全部

### 2. 扫描可用翻译

当用户启动在线扫描时：

1. 应用程序使用翻译提供者搜索翻译
2. 对于每个未翻译的模组，它查询Nexus Mods和/或Confrerie
3. 它根据用户的语言偏好过滤结果
4. 它向用户呈现可用翻译列表

### 3. 下载翻译

当用户选择要下载的翻译时：

1. 应用程序下载翻译文件
2. 它根据文件格式提取和处理文件
3. 它将翻译转换为内部格式
4. 它将翻译添加到数据库
5. 它更新受影响插件的状态

### 4. 创建翻译

用户可以使用翻译编辑器创建新翻译：

1. 用户选择要翻译的插件
2. 应用程序从插件中提取字符串
3. 用户可以手动翻译字符串或使用翻译API
4. 应用程序将翻译保存到数据库

### 5. 构建输出

要在游戏中应用翻译：

1. 用户为Dynamic String Distributor (DSD)构建输出
2. 应用程序将翻译导出为DSD格式
3. 它创建一个可以在模组管理器中安装的模组
4. DSD在游戏中应用翻译

## 字符串处理

### 字符串提取

使用以下过程从插件中提取字符串：

1. 应用程序解析插件文件结构
2. 它识别包含可翻译字符串的记录
3. 它提取字符串及其元数据（编辑器ID、表单ID、类型）
4. 它为每个提取的字符串创建String对象

### 字符串翻译

字符串可以通过几种方式翻译：

1. **手动翻译**
   - 用户直接在翻译编辑器中输入翻译
   - 最准确但耗时

2. **自动翻译**
   - 使用翻译API自动翻译字符串
   - 快速但可能需要手动审核

3. **数据库翻译**
   - 应用数据库中的现有翻译
   - 对于出现在多个插件中的字符串很有用

### 字符串状态

每个字符串都有一个状态，指示其翻译状态：

1. **需要翻译**
   - 字符串需要翻译
   - 不存在翻译

2. **翻译未完成**
   - 字符串已自动翻译
   - 需要手动审核

3. **翻译完成**
   - 字符串已翻译并验证
   - 可以使用

4. **不需要翻译**
   - 字符串不应该被翻译
   - 由用户标记为跳过

## 输出格式

SSE-AT为Dynamic String Distributor (DSD) SKSE插件生成输出：

1. **文件结构**
   - 创建与DSD兼容的目录结构
   - 按插件组织翻译

2. **JSON格式**
   - 将翻译导出为JSON文件
   - 每个文件包含插件的翻译字符串

3. **元数据**
   - 包含有关原始字符串的信息
   - 保留编辑器ID、表单ID和字符串类型

## 与Dynamic String Distributor集成

Dynamic String Distributor (DSD)是一个在游戏中应用翻译的SKSE插件：

1. DSD加载由SSE-AT生成的翻译文件
2. 它拦截来自游戏的字符串请求
3. 它用翻译版本替换原始字符串
4. 它处理不同的字符串类型和上下文

这种方法允许在不修改原始插件文件的情况下应用翻译，使其与更新和其他模组兼容。

## 工作流程图

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   模组管理器    │────▶│   模组扫描器    │────▶│   在线扫描器    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                                                         │
                                                         ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  DSD输出生成器  │◀────│   翻译数据库    │◀────│   翻译下载器    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        │                        ▲
        │                        │
        ▼                        │
┌─────────────────┐     ┌─────────────────┐
│ Dynamic String  │     │    翻译编辑器   │
│   Distributor   │     │                 │
└─────────────────┘     └─────────────────┘
```
